---
import { site } from '../constants'
---

<a
  href="/"
  class="font-display hover:text-highlight relative inline-block text-2xl font-light text-stone-700 no-underline underline-offset-1 dark:text-stone-100"
>
  <span class="drop-shadow-header">{site.title}</span>
  <span
    aria-hidden="true"
    class="absolute left-0 z-10 h-[125%] w-full overflow-hidden"
  >
    <span
      id="wavy"
      class="decoration-highlight decoration-skip-ink-none relative whitespace-nowrap text-transparent underline decoration-wavy"
      style={{ left: 'var(--offset, 0%)' }}></span>
  </span>
</a>

<script>
  const wavy = document.getElementById('wavy')

  const onScroll = () => {
    if (wavy) {
      const offset = window.pageYOffset

      wavy.style.setProperty(
        '--offset',
        `${offset <= -100 ? -200 : (offset % 100) - 100}%`
      )
    }
  }

  const scrollEventListener = (hasReducedMotion: boolean) =>
    hasReducedMotion
      ? window.removeEventListener('scroll', onScroll)
      : window.addEventListener('scroll', onScroll)

  const reducedMotion = window.matchMedia('(prefers-reduced-motion: reduce)')
  reducedMotion.addEventListener('change', ({ matches: hasReducedMotion }) =>
    scrollEventListener(hasReducedMotion)
  )

  window.addEventListener('load', () => {
    if (wavy) {
      const title = document.querySelector('a[href="/"] > span:first-of-type')
      const site = title?.textContent?.trim() ?? ''

      setTimeout(() => {
        wavy.innerText = `${site} ${site}`

        scrollEventListener(reducedMotion.matches)
      }, 1000)
    }
  })
</script>
